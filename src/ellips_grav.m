function [gama,DRV_gama_h,Jcf,GMo,Uo] = ellips_grav(phi,ellips)


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Gravity field functionals based on spherical harmonics
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Purpose:
%   Computation of functionals (e.g. geoid height, gravity anomaly, ...)
%   based on the spherical harmonics expansion and the harmonics
%   coefficients of an Earth Gravity Model (EGM).
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Input arguments:
% - phi : Geodetic Latitude in degrees
%
% Output arguments:
% - gama       : Normal gravity in mgal
% - DRV_gama_h : Gradient of Normal gravity
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Dr. Thomas D. Papanikolaou                                     March 2013
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% degrees to radians conversion
cf_deg2rad = (pi / 180);
phi_rad = cf_deg2rad * phi;

% ellips = 2;

if ellips == 2
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% GRS'80
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
a = 6378137; % m
f = 1 / 298.2572221;
omega = 7292115 * 10^-11; % rad sec^-1

GMo = 398600.5000 * 10^9;  % earth gravity constant [m^3/sec^2]
Uo_model = 62636860.85;  % [m^2/sec^2]

gama_e = 9.7803267715; % m/sec^2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

elseif ellips == 1
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% WGS84
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
a = 6378137;
f = 1 / 298.257223563;
omega = 7292115 * 10^-11; % rad sec^-1

GMo = 3.986004418 * 10^14 ; % earth gravity constant [m^3/sec^2]
Uo_model  =  62636851.71;  % m^3 / sec^2

gama_e = 9.7803253359; % m/sec^2
gama_p = 9.8321849378; % m/sec^2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
end


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%b = 6356752.31414; % m
b = a * (1 - f);
E = sqrt(a^2 - b^2);
e  = sqrt(1 - b^2 / a^2);
% e' = E / b second eccintricity
e2 = E / b;
qo = (1/2) * ( (1 + 3*(b^2/E^2) ) * atan(E/b) - 3 * (b/E) );
m = (omega^2 * a^2 * b) / GMo;

CAM = (1/3) * E^2 * (1 - (2/15) * m * (e2 / qo) );

Uo = (GMo / E) * atan(E/b) + (1/3) * omega^2 * a^2;

for n = 1 : 5
    Jno(n,1) = (-1)^(n+1) * 3 * e^(2*n) * (1 / ( (2*n+1) * (2*n+3) )) * (1 - n + 5*n * (CAM / E^2));
end
% J coefficients
Jcf = Jno;
% Jcf = [J2 J4 J6 J8]';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Normal Gravity
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

if ellips == 2
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Gravity formula GRS'80
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% series expanision
gama = gama_e * (1 + 0.0052790414 * sin(phi_rad)^2 + 0.0000232718 * sin(phi_rad)^4 + 0.0000001262 * sin(phi_rad)^6 + 0.0000000007 * sin(phi_rad)^8);
% mgal
gama = gama * 10^(5);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

elseif ellips == 1
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% WGS'84 formula
gama = gama_e * 10^5 * (1 + 0.00193185265241 * sin(phi_rad)^2 ) * (1 / sqrt(1 - 0.00669437999014 * sin(phi_rad)^2) ); % mgal
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Gradient of normal gravity
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
m = (omega^2 * a^2 * b) / GMo;
% mgal/m
DRV_gama_h = - (2 * gama / a) * (1 + f + m - 2 * f * sin(phi_rad)^2 );
